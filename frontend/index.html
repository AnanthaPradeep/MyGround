<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/logo-192.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="MyGround - India's most trusted real estate marketplace with MG Asset DNAâ„¢ verification" />
    <meta name="theme-color" content="#0259bb" />
    <title>MyGround - Real Estate Platform</title>
    
    <!-- Resource Hints for Performance -->
    <!-- Preconnect to API domains for faster connection (300ms savings) -->
    <link rel="preconnect" href="https://api.myground.in" crossorigin>
    <link rel="preconnect" href="https://myground-1.onrender.com" crossorigin>
    <link rel="dns-prefetch" href="https://nominatim.openstreetmap.org">
    
    <!-- Preload critical logo image -->
    <link rel="preload" href="/logo2.svg" as="image" type="image/svg+xml">
    
    <!-- Note: Fonts are NOT preloaded to avoid blocking render.
         They use font-display: swap/optional for optimal performance.
         Preloading large fonts (Merriweather 2.8MB) would block LCP. -->
    <script>
      // Apply theme immediately to prevent flash
      (function() {
        const savedTheme = localStorage.getItem('theme');
        const root = document.documentElement;
        
        // Remove any existing theme classes
        root.classList.remove('light', 'dark');
        
        if (savedTheme === 'light' || savedTheme === 'dark') {
          // Use saved theme
          root.classList.add(savedTheme);
        } else {
          // Default to light mode (can be changed to check system preference)
          root.classList.add('light');
          localStorage.setItem('theme', 'light');
        }
      })();
      
      // Apply language and direction immediately to prevent flash
      (function() {
        const savedLang = localStorage.getItem('myground-language-storage');
        const root = document.documentElement;
        
        if (savedLang) {
          try {
            const langData = JSON.parse(savedLang);
            if (langData.state?.selectedLanguage) {
              const lang = langData.state.selectedLanguage;
              root.setAttribute('dir', lang.direction || 'ltr');
              root.setAttribute('lang', lang.languageCode || 'en');
            } else {
              root.setAttribute('dir', 'ltr');
              root.setAttribute('lang', 'en');
            }
          } catch (error) {
            root.setAttribute('dir', 'ltr');
            root.setAttribute('lang', 'en');
          }
        } else {
          root.setAttribute('dir', 'ltr');
          root.setAttribute('lang', 'en');
        }
      })();
    </script>
    
    <!-- Defer non-critical CSS loading to prevent render blocking -->
    <script>
      // Make CSS load asynchronously to prevent render blocking
      // Uses MutationObserver to catch stylesheets as they're injected by Vite
      (function() {
        function makeNonBlocking(link) {
          // Check if it's a non-critical CSS file (map-vendor, vendor chunks, etc.)
          const href = link.getAttribute('href') || '';
          const isNonCritical = href.includes('map-vendor') || 
                                href.includes('vendor') || 
                                href.includes('leaflet');
          
          if (isNonCritical && !link.hasAttribute('data-nonblocking')) {
            // Use media trick: set to print first, then switch to all after load
            link.setAttribute('media', 'print');
            link.setAttribute('data-nonblocking', 'true');
            
            link.onload = function() {
              this.setAttribute('media', 'all');
            };
            
            // If already loaded, switch immediately
            if (link.sheet || link.styleSheet) {
              link.setAttribute('media', 'all');
            }
          }
        }
        
        // Process existing stylesheets
        document.querySelectorAll('link[rel="stylesheet"]').forEach(makeNonBlocking);
        
        // Watch for new stylesheets being added (Vite injects them dynamically)
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
              if (node.nodeName === 'LINK' && node.getAttribute('rel') === 'stylesheet') {
                makeNonBlocking(node);
              }
            });
          });
        });
        
        // Start observing
        observer.observe(document.head, {
          childList: true,
          subtree: true
        });
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

